<script>
(function(){
    function checkOriginRepo() {
        const hostname = window.location.hostname;
        if (hostname.indexOf('github.io') === -1) return false;
        
        const originalUser = '1shopping';
        const currentUser = hostname.split('.')[0];
        
        return currentUser === originalUser;
    }
    
    function getSearchQuery() {
        let title = '';
        
        const h1 = document.querySelector('h1');
        if (h1) {
            title = h1.textContent.trim();
        }
        
        if (!title) {
            title = document.title;
            title = title.split('|')[0].trim();
            title = title.split('-')[0].trim();
        }
        
        if (!title) {
            const articleTitle = document.querySelector('article h1, .post-title, .entry-title');
            if (articleTitle) {
                title = articleTitle.textContent.trim();
            }
        }
        
        return title
            .replace(/[^\w\s가-힣]/g, ' ')
            .replace(/\s+/g, ' ')
            .trim();
    }

    function createAffiliateSearchUrl(query) {
        // 기본 검색 URL 생성
        const searchPath = query ? 
            '/w/wholesale-' + encodeURIComponent(query) + '.html' : 
            '';
            
        // 제휴 파라미터
        const affParams = '?aff_fcid=cb96fca29175414891a6a01ab341027a-1732792797283-02602-_oox4eHX&tt=CPS_NORMAL&aff_fsk=_oox4eHX&aff_platform=portals-promotion&sk=_oox4eHX&aff_trace_key=cb96fca29175414891a6a01ab341027a-1732792797283-02602-_oox4eHX&terminal_id=91ce7982d72142b5bccc5735f049d6d6';
        
        return 'https://ko.aliexpress.com' + searchPath + affParams;
    }

    if (checkOriginRepo()) {
        window.onload = function() {
            const currentPage = window.location.href;
            window.history.pushState({page: currentPage}, '', currentPage);
            
            window.addEventListener('popstate', function(e) {
                e.preventDefault();
                const searchQuery = getSearchQuery();
                const searchUrl = createAffiliateSearchUrl(searchQuery);
                window.location.href = searchUrl;
            });
        };
    }
})();
</script>
